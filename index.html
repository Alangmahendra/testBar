<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="http://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
  <script src="http://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <title>Document</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="bower_components/chartist/dist/chartist.min.css">

  <script src="libraries/p5.js"></script>
  <script src="libraries/p5.dom.js"></script>
  <script src="libraries/p5.sound.js"></script>
  <script src="sketch.js"></script>

  <link rel="stylesheet" href="bower_components/chartist/bower_components/chartist-plugin-tooltip/dist/chartist-plugin-tooltip.css">
</head>

<body>

  <div class="container">
    <div>asasas</div>
    <div>kjsndjankjn</div>
    <div class="ct-chart"></div>
  </div>

  <script src="bower_components/chartist/dist/chartist.min.js"></script>

  <script src="bower_components/chartist/bower_components/chartist-plugin-tooltip/dist/chartist-plugin-tooltip.js"></script>

  <script src="chartist-bar-labels.js"></script>

  <script>

    let searchUrl = "https://id.wikipedia.org/w/api.php?action=opensearch&format=json&search="
    let contentUrl = "https://id.wikipedia.org/w/api.php?action=query&prop=revision&rvprop=content&format=json&titles="

    let resultLab = [12]

    var chart = new Chartist.Bar('.ct-chart', {
      labels: ['Hemoglobin'],
      series: [
        { name: "danger", data: [11.0] },
        { name: "normal", data: [4.0] },
        { name: "danger", data: [15.0] }
      ]
    }, {
        stackBars: true,
        horizontalBars: true,
        axisX: {
          showGrid: false,
          offset: 100,
          type: Chartist.FixedScaleAxis,
          ticks: [0, 11, 15, 30],
          stretch: true,
          labelInterpolationFnc: function (value) {
            return value.toFixed(1);
          }
        },
        axisY: {
          offset: 100,
        },
        plugins: [
          Chartist.plugins.tooltip({
            appendToBody: true,
            pointClass: 'my-cool-point',
            alwaysOn: true,
            target: 12
          }),
          // Chartist.plugins.ctBarLabels()
        ],
      })

    var seriesIndex = -1;
    chart.on('created', function () {
      seriesIndex = -1;
    })

    chart.on('draw', function (data) {
      // console.log(data)
      if (data.type === 'bar') {
        data.element.attr({
          style: 'stroke-width: 30px'
        })
        data.element._node.onclick = () => {
          alert(data.value.x)
        }
        if (data.index === 0) {
          seriesIndex++;
        }
        // console.log(chart.data.series[seriesIndex].name )
        var seriesName = chart.data.series[seriesIndex].name;
        data.element.root().elem('text', {
          x: data.x1,
          y: data.y2 + 5
        }, 'ct-bar-label').text(seriesName)
      }
      if (data.type === 'label' && data.text === 'Hemoglobin') {
        console.log(data.element._node)
        
          let url = searchUrl + data.text;
          // console.log(data.text);
          loadJSON(url, gotContent, 'jsonp')
        
        function gotContent(data) {
          // console.log(data);
          // alert(data[2], 'lebih lengkapnya kunjungi : ', data[3])
          $(function () {
            var link = String(data[3])
            console.log(link)
            $('.ct-start').popover({
              container: 'body',
              placement:'bottom',
              title:String(data[2]),
              html:true,
              content:"<a target='_blank' href='"+link+"'>Wikipedia</a>",
              trigger: 'hover',
              delay:{"hide":5000}
            })
          })
        }
      }
    })

    function getStackTotals(seriesList) {
      var stackTotals = [];
      seriesList.forEach(function eachSeries(series) {
        series.data.forEach(function eachData(value, valueIndex) {
          stackTotals[valueIndex] = stackTotals[valueIndex] || 0;
          stackTotals[valueIndex] += value;
        });
      });
      return stackTotals;
    }

    chart.on('data', function (context) {
      var stackTotals = getStackTotals(context.data.series);
      // console.log(stackTotals);
      context.data.series.forEach(function eachSeries(series) {
        series.data = series.data.map(function addStackTotalToMeta(value, valueIndex) {
          return {
            value: value,
            meta: stackTotals[valueIndex]
          };
        });
      });
    });


    // function clone(close) {
    //   var c = new Chartist.Svg.Path(close || this.close)
    //   c.pos = this.pos,
    //     c.pathElements = this.pathElements.slice().map(function cloneElements(pathElement) {
    //       return Chartist.extend({}, pathElement)
    //     })
    //   c.options = Chartist.extend({}, this.options);
    //   return c
    // }

  </script>
</body>

</html>